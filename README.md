# 📘 Git プロジェクト初期化 & 運用手順（テンプレート）

## 🧱 初回プロジェクト作成時（GitHubと連携するまで）

1. プロジェクトディレクトリを作成
```bash
mkdir your_project_name
cd your_project_name
```

2. 仮想環境を構築
```
python -m venv venv
source venv/bin/activate  # Windowsは .\venv\Scripts\activate
```

3. Gitを初期化
```
git init
```

4. .gitignoreを作成
```
venv/
__pycache__/
*.pyc
.DS_Store
```

5.README.mdの作成
```
touch README.md
```

6.GitHubで新規リポジトリを作成
 - 右上の＋ボタンからNew repositoryを押下
 - 「READMEを初期化」のチェックは外す

7.GitHubとリモート接続
```
git remote add origin https://github.com/yourusername/your_project_name.git
git branch -M main
```

8.最初のコミット&push
```
git add .
git commit -m "Initial commit"
git push -u origin main
```

## 🔁以降の運用（変更を保存するたびに）
1.変更をステージに追加
```
git add .
```

2.コミットする
```
git commit -m "ここに変更内容を書く"
```

3.GitHunへ反映(push)
```
git push
```

# 🚀開発のロードマップ(Backend)

## 🔷 ステージ 1：コアスクリーニングエンジンの実装
🎯 目的：
複数の東証上場株式を取得し、移動平均線(EMA5,EMA20,EMA40)を計算し、6つのステージに分類できること。

🗃️ ディレクトリ構成
```
stock_screening_app/
├── main.py                 ← 起動ファイル
├── TickerLoader.py         ← data_j.xlsをloadし、yfinanceで利用できるように前処理するクラス
├── StockDataFetcher.py     ← yfinanceから株価を取得し、EMAを計算するクラス
├── StageAnalyzer.py        ← ステージを判定するクラス
├── BatchScreening.py       ← スクリーニングを実行し、キャッシュとして保存しておく。
├── requirements.txt
└── README.md
```
## 🔷 ステージ 2：Web UIの構築（ステージ選択UI）
🎯 目的：
「大循環分析」セクションに、ステージ1〜6のチェックボックスを用意し、該当銘柄を一覧表示する画面を構築

✅ タスク：

 HTML + JSベースのUI（例：Bootstrap + Vanilla JS）

 ステージ1〜6のチェックボックスを配置

 チェックボックスの状態をもとにAPIを呼び出し

 結果を表形式で描画（銘柄コード、銘柄名、ステージなど）

 チャートページ（Yahooなど）へのリンクも追加

🖥️ フロントエンドのUIイメージ（ざっくり）
```
[市場]
[]東証プライム市場
[]東証スタンダード市場
[]東証グロース市場

[出来高]
【下限】~ 【上限】

 [ 移動平均線大循環分析 ]
[✔] ステージ1
[✔] ステージ2
[ ] ステージ3
[ ] ステージ4
[✔] ステージ5
[ ] ステージ6

[ 検索ボタン ]

--- 結果 ---
| 銘柄コード | 銘柄名 | 直近出来高　|　直近終値　|現在のステージ |　 チャートリンク |
|------------|--------|----------|-----------|----------------|----------------|
| 7203       | トヨタ | 40000　　|　　2,500　　|　　ステージ1    | [リンク]       |
| 9984       | ソフトバンクG | 40000|2,500　　|　　ステージ1    | [リンク] |
```

## 🔷 ステージ 3：ステージ別データキャッシュ・JSON生成
🎯 目的：
全銘柄の大循環分析を定期実行しておき、結果をAPIで即返せるようにする。現状では、検索するたびにすべての銘柄のスクリーニングを実施しているため、時間がかかるのに対して、キャッシュを使うことでスクリーン済の結果をすぐ返却できるようになる。

✅ タスク：
 スクリーニングバッチ（例：BatchScreening.py）作成
 * 全銘柄のステージを一括判定し、JSONファイルで保存する。
 ```
 output/
└── screening_result.csv   ← 日付別キャッシュ（オプション）
 ```

## 🔷 ステージ 4：定期スクリーニングの自動実行（GitHub Actionsなど）
🎯 目的：
株価データは日々変わるため、毎日朝に自動スクリーニングを行い、最新結果を保存する。

✅ タスク：

 batch_screening.py をGitHub Actionsやcronで自動実行
   * data_j.xlsの上場銘柄の一覧の最新化　⇒　最新化され次第？※ここをどう最新化するか・・
   * output/のスクリーニング結果の最新化　⇒ 1日1回？

 結果ファイルを data/ に更新

 必要に応じて差分チェックやログ出力も整備

 ## 🔷 ステージ 5：Discord連携機能の実装
🎯 目的：
Webhookを用いて、Pythonから通知を送る。

✅ タスク：

### Discord通知システム構築
- Discordサーバーを作成（または既存を使用）
- 通知用チャンネルを作成
- Webhookを発行

## 🔷 ステージ 6：分析機能の拡張
🎯 目的：
移動平均線大循環分析に基づいた株のスクリーニングに終始した現状のUI分析から、売買の半自動化の機能拡張を目指す。下記の機能を持ったシステムを作りたい。
   * 前提となる売買条件をUIから設定する。
   * 前提条件、テクニカル分析に基づき、買う（売る）べき銘柄を通知する。
   * 保有している銘柄が利確のタイミングとなったら通知する。
   * 売ったら保有銘柄DBから破棄し、通知はしない。

### UI、通知イメージとフロー整理
   1. 売買条件設定UI

 ```
 ～～～スクリーニング機能設定～～～
 【市場選択】
   []プライム市場
   []スタンダード市場
   []グロース市場
 【予算設定】
   下限～上限
【通知設定】
   OFF/ON
                                                   保存
 
```

   2. 銘柄選定Discord通知
```
         💰本日のおすすめの銘柄一覧を通知します💰

         【📈買いのおすすめ📈】
         銘柄　　　　　　　　　スコア　　　　逆指値エントリー金額　　　　ロスカット金額
         4722:フューチャー　　　70点　　　　2,200円　　　　　　　　　　　2,150円

         【📉空売りのおすすめ📉】
         銘柄　　　　　　　　　スコア　　　　逆指値エントリー金額　　　　ロスカット金額
         3407:旭化成　　　　　70点　　　　　1,000円　　　　　　　　　　　1,150円

```
   3. エントリー設定
```
～～～エントリー設定～～～
【対象銘柄】
【購入価格】※できるだけ項目は減らし、必須項目はselectして保存したい。
                                                保存
```
   4. 利益確定Discord通知
```
         ‼️売り時が来ました‼️
         あなたの保有する銘柄を下記の条件で売ってください。

         銘柄　　　　　　　　　注文区分　　　　　　　　金額
         4722:フューチャー　　売り注文　　　　　　　　2,300円
         3407:旭化成　　　　　返済注文　     　　　　成行
```


 ### 要件定義
 
 0. 前提となるスクリーニング前の条件の選択機能(銘柄スクリーニング画面から遷移して、通知条件画面に移るように別途実装予定)
      * 対象となる市場の選択
         * プライム、スタンダード、グロースのチェックボックス
      * 予算情報としての希望終値の下限と上限（1銘柄あたりの終値）
         * テキストボックスで入力し、その条件に合った株式を探す
      * 通知無効チェックボックス
         * 基本は1日1回（市場が終わった16時以降にBatchで動かすイメージ。）だが、そのチェックを入れた場合、CI自体のジョブを止める。
      * 保存ボタン
         * これはDBで管理かな？
 1. 売買すべき銘柄のスクリーニング～通知機能（すべての条件を満たす銘柄ではなく、スコアリングし、60点以上の銘柄を通知する）
      * 前提条件としてエントリー時に下記のdataとして保存
         * エントリー価格（buy_price）

         * エントリー時のATR（atr_entry）

         * 目標利幅倍率（TP倍率、例：3ATR）

         * ロスカット価格（stop_loss_price）

         * エントリー日（entry_date）

         * ポジションの種類（現物 or 信用売買）
      * 共通条件
         * 出来高が極端に少ない銘柄は回避する。
         * 決算直前（5営業日以内）の銘柄は回避する。
      * 買うべき銘柄の条件
         * 大循環分析※ほぼ実装済
            * ステージ1
            * 3本とも上昇傾向にある。傾きがプラス
         * 出来高
            * 直近3日平均のOBVが上昇傾向にある
               例：OBV[-1] > OBV[-2] > OBV[-3]

            * 直近のOBVが、過去20日移動平均のOBVを上回っている
               例：OBV[-1] > OBV_MA20[-1]

            *  出来高が5日 or 20日移動平均の1.5倍以上であること（既存条件と統合）
         * RSI
            * RSIが50~70の範囲内にあること
         * MACD
            * MACDライン > シグナルライン
            * MACDゴールデンクロス直後（数日以内）
         * ボリンジャーバンド
            * 終値が+1σ~+2σの間にあること

      * 空売りすべき銘柄の条件
         * 大循環分析※ほぼ実装済
            * ステージ4
            * 3本のEMAともに減少傾向にある。
         * 出来高
            * 直近3日間のOBVが減少傾向
               例：OBV[-1] < OBV[-2] < OBV[-3]

            * OBV[-1] < OBV_MA20[-1]（中期的にも売り圧強し）

            * 出来高が5日 or 20日移動平均の1.5倍以上
            　→ 売り圧力を伴う下落（需給悪化の裏付け）

         * RSI
            * RSIが30〜50の範囲
            （20以下は反発リスクがあるので避ける、50超えると勢いが戻る）

            *  RSIが下向きである（下降トレンド中）
         * MACD
            * MMACDライン < シグナルライン（デッドクロス状態）
            * MACDデッドクロス後、2〜3営業日以内（勢いが残っている）
         * ボリンジャーバンド
            * 終値が**-1σ〜-2σ**の範囲内（下抜け・弱含み）

            * バンド幅が拡大している場合（ボラ拡大 → トレンド継続のサイン）

      * ロスカット設定
         * 2ATR
         * キリの良い数字
         
            Ex) 現値：1365円、2ATR:101円、損切ライン：1264円⇒1250円

 2.  利確すべきタイミングの条件～通知
      * 売りのタイミング
         * 固定利幅
            * 現在価格 >= buy_price + (atr_entry × 利幅倍率)
            　例：2ATRや3ATRなど。
　             → 利幅を明確に設定し、それに到達すれば即利確。
         2. ステージ転換
            * トレンド転換の兆候があれば、目標未達でも利確。
         3. 高値からの下落率（トレーリングストップ）
            * エントリー後の最高値（max_price）から、-1.5ATR以上の下落
            　例：現在価格 <= max_price - (1.5 × atr_entry)
　          → 含み益を確保しつつ、損失転換前に撤退。
         4. ローソク足パターンで利確
            * 陰線3本連続（連続包み足や大陰線）

            * ピンバー（上ヒゲ大）＋出来高増 → 売り圧力増
            ※チャートパターン認識が難しい場合は後回し可。

         5. テクニカル指標での逆転シグナル
            * RSI > 70 からの下落 or MACDデッドクロス

            * BBの+2σからローソク足が下抜け

      * 買い戻しのタイミング

         1. 目標利益幅（リスクリワード比）に到達
         定義：エントリーポイントから3ATR以上下落

         意図：一般的なリスクリワード比（損切り1：利確3）に基づく
         ```
         計算例：
         空売りエントリー価格：1,000円
         1ATR：20円 → 利確目標価格 = 1,000 - (20 × 3) = 940円
         ```
         2. 短期移動平均線が中期移動平均線を上抜け（ゴールデンクロス）
            * トレンド転換の兆しとして利確を検討
         ```
         例：5EMAが25EMAを上抜け
         ```
         3. RSIが売られ過ぎゾーン（例：30以下）から反発
         
            売りのピークを過ぎた可能性あり

         4. MACDシグナルが上向きクロス（デッドクロス解除）
            ダイバージェンス（MACDが上昇トレンド）検出時も注意

         5. 価格が下降トレンド中に一定割合戻したら利確（トレーリングストップ）
         
         例：最高利益地点から1ATR以上反発で利確

         6. 下落中に急激な出来高上昇＋陽線出現
         空売りの買い戻し（ショートカバー）リスクと判断
         ```
         例：5日平均出来高の2倍以上の出来高 + 陽線終値が前日高値を超えた
         ```
         7. 決算・IR・大型材料発表予定の前日
         逆行リスクを避けるため、イベント前に手仕舞い

         例：決算発表3営業日前に全返済

